Modify this code with above changes. Don't change the original code structure